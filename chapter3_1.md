# 3.1. Проектирование структуры базы данных

Система управления данными построена на реляционной базе данных SQLite, которая обеспечивает надежное хранение информации без необходимости развертывания отдельного сервера баз данных. Выбор SQLite обусловлен простотой развертывания, высокой производительностью для локальных приложений и встроенной поддержкой транзакций.

## Архитектура базы данных

Структура базы данных спроектирована с учетом принципов нормализации для предотвращения дублирования данных и обеспечения целостности информации. База включает четыре основные таблицы: администраторы системы, пользователи для распознавания, журналы событий распознавания и системные настройки.

Таблица администраторов содержит учетные записи лиц, имеющих доступ к управлению системой. Каждая запись включает уникальный идентификатор, имя пользователя, адрес электронной почты, хэш пароля с солью для обеспечения безопасности, статус активности учетной записи и временные метки создания и последнего входа в систему.

Система аутентификации администраторов использует современные методы хеширования паролей с индивидуальными солями для каждой учетной записи. Это предотвращает атаки по словарю и обеспечивает безопасность даже в случае компрометации файла базы данных.

Таблица пользователей для распознавания хранит информацию о лицах, зарегистрированных в системе для идентификации. Структура включает персональные данные пользователя, путь к фотографии, биометрический шаблон лица в JSON формате и метаданные о регистрации.

## Хранение биометрических данных

Биометрические шаблоны лиц представляют собой численные векторы из 128 элементов, которые хранятся в базе данных в формате JSON. Такой подход обеспечивает читаемость данных и простоту обработки, хотя в будущих версиях планируется замена на более эффективные бинарные форматы с шифрованием.

Целостность биометрических данных контролируется через контрольные суммы, которые вычисляются при сохранении шаблона и проверяются при каждом обращении к данным. Это позволяет обнаруживать повреждения или несанкционированные изменения биометрических шаблонов.

Индексирование биометрических данных выполняется по идентификатору пользователя и статусу активности для ускорения операций поиска. Дополнительные индексы создаются для часто используемых полей, таких как дата создания записи и идентификатор администратора, создавшего запись.

Резервное копирование биометрических данных автоматизировано и выполняется ежедневно с сохранением нескольких версий архивов. Система контролирует размер архивов и автоматически удаляет устаревшие копии для экономии дискового пространства.

## Журналирование и аудит

Таблица журналов распознавания фиксирует каждое событие идентификации пользователя с детальной информацией о времени, результате распознавания, уровне уверенности системы и дополнительных метаданных. Эта информация критически важна для анализа работы системы и расследования инцидентов.

Структура записи журнала включает ссылку на идентифицированного пользователя, временную метку с точностью до миллисекунд, числовой показатель уверенности распознавания и тип события (успешное распознавание, неизвестное лицо, ошибка обработки).

Производительность журналирования оптимизирована через использование пакетной записи событий и асинхронной обработки. Это предотвращает блокировку основных операций системы при интенсивном журналировании и обеспечивает отзывчивость пользовательского интерфейса.

Архивирование старых записей журнала выполняется автоматически для поддержания производительности базы данных. Записи старше определенного периода переносятся в архивные таблицы или экспортируются во внешние файлы для долгосрочного хранения.

## Обеспечение целостности данных

Система управления базой данных включает механизмы контроля целостности на нескольких уровнях. Внешние ключи обеспечивают ссылочную целостность между связанными таблицами, предотвращая создание записей с несуществующими ссылками.

Ограничения уникальности применяются к критическим полям, таким как идентификаторы пользователей и имена администраторов, для предотвращения дублирования записей. Проверочные ограничения контролируют корректность формата данных, например, валидность адресов электронной почты.

Транзакционная целостность обеспечивается через использование транзакций базы данных для всех операций изменения данных. Сложные операции, затрагивающие несколько таблиц, выполняются в рамках одной транзакции для обеспечения атомарности изменений.

Восстановление после сбоев реализовано через автоматическое создание точек восстановления и проверку целостности базы данных при запуске системы. При обнаружении повреждений система пытается восстановить данные из резервных копий или предлагает пользователю варианты исправления проблем.

## Оптимизация производительности

Индексы базы данных созданы для всех часто используемых полей поиска и сортировки. Композитные индексы используются для сложных запросов, которые фильтруют данные по нескольким критериям одновременно.

Кэширование результатов запросов реализовано на уровне приложения для уменьшения нагрузки на базу данных. Часто запрашиваемые данные, такие как список активных пользователей, сохраняются в памяти и обновляются только при изменении базовых данных.

Пакетная обработка применяется для операций, затрагивающих большое количество записей. Вместо выполнения множества отдельных запросов система группирует операции и выполняет их в рамках одной транзакции.

Мониторинг производительности включает отслеживание времени выполнения запросов, использования индексов и общей нагрузки на базу данных. Статистика производительности используется для выявления узких мест и оптимизации проблемных запросов.

## Безопасность базы данных

Защита файла базы данных обеспечивается через ограничение прав доступа на уровне файловой системы. Только учетная запись, под которой работает приложение, имеет права чтения и записи файла базы данных.

Подготовленные запросы используются для всех операций с пользовательскими данными для предотвращения атак внедрения SQL кода. Все входные параметры проходят валидацию и санитизацию перед передачей в базу данных.

Аудит доступа к базе данных ведется через системный журнал, который фиксирует все операции чтения и записи с указанием времени и контекста выполнения. Подозрительная активность автоматически выявляется и регистрируется для дальнейшего анализа.

Шифрование базы данных планируется к внедрению в следующих версиях системы для обеспечения дополнительной защиты биометрических данных. Это потребует интеграции специализированных криптографических модулей и модификации процедур резервного копирования.