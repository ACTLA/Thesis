# 4.1. Выявление уязвимостей текущей реализации

Анализ реализованной системы распознавания лиц выявляет ряд существенных уязвимостей информационной безопасности, характерных для биометрических систем без специализированных модулей защиты. Выявленные проблемы затрагивают все основные компоненты системы и требуют комплексного подхода к их устранению.

## Уязвимости алгоритмов распознавания

Основной движок распознавания в файле `face_recognition_engine.py` принимает любое изображение с обнаруженным лицом без проверки его подлинности. Метод `process_frame` обрабатывает статические изображения точно так же, как живые лица, что открывает возможности для презентационных атак.

```python
def _detect_faces(self, frame):
    small_frame = cv2.resize(frame, (0, 0), fx=RESIZE_SCALE, fy=RESIZE_SCALE)
    rgb_frame = cv2.cvtColor(small_frame, cv2.COLOR_BGR2RGB)
    
    # Система не проверяет признаки живого лица
    face_locations = face_recognition.face_locations(rgb_frame, model='hog')
    face_encodings = face_recognition.face_encodings(rgb_frame, face_locations)
```

Злоумышленник может использовать распечатанные фотографии, изображения с экрана монитора или даже фотографии из социальных сетей для обмана системы. Отсутствие анализа глубины, движения или других признаков живого присутствия делает систему уязвимой для простейших типов атак подмены.

Диалог добавления пользователей в `AddUserDialog` не ограничивает источники загружаемых изображений и не анализирует метаданные файлов. Метод `process_image_file` принимает любые изображения в поддерживаемых форматах без проверки их происхождения.

## Проблемы хранения биометрических данных

Класс `Database` сохраняет биометрические шаблоны в незашифрованном JSON формате в базе данных SQLite. Метод `add_user` записывает 128-элементные векторы признаков лица в открытом виде, что создает критический риск при компрометации файла базы данных.

```python
def add_user(self, user_data: Dict, created_by: int) -> Optional[int]:
    cursor.execute('''
        INSERT INTO users 
        (user_id, full_name, email, phone, photo_path, face_encoding, created_by)
        VALUES (?, ?, ?, ?, ?, ?, ?)
    ''', (
        user_data['user_id'],
        user_data['full_name'],
        user_data.get('email', ''),
        user_data.get('phone', ''),
        user_data.get('photo_path', ''),
        json.dumps(user_data.get('face_encoding', [])),  # Незашифрованные данные
        created_by
    ))
```

Кэширование биометрических шаблонов в оперативной памяти через списки `known_encodings` и `known_users` создает дополнительные точки утечки данных. Дамп памяти процесса может раскрыть все биометрические характеристики зарегистрированных пользователей.

Файловое кэширование через модуль `pickle` в методе `_save_to_cache` создает дополнительную незащищенную копию биометрических данных в файловой системе. Файл `ENCODINGS_FILE` содержит все биометрические шаблоны в формате, доступном для чтения любыми программами.

## Недостатки системы аудита

Журналирование событий распознавания ограничивается записью базовой информации без контекстных данных о безопасности. Метод `add_recognition_log` фиксирует только успешные идентификации без регистрации подозрительных паттернов или множественных неудачных попыток.

```python
def add_recognition_log(self, user_id: int, confidence: float, recognition_type: str = 'SUCCESS'):
    # Отсутствует информация об IP-адресе, сессии, источнике запроса
    cursor.execute('''
        INSERT INTO recognition_logs (user_id, confidence, recognition_type)
        VALUES (?, ?, ?)
    ''', (user_id, confidence, recognition_type))
```

Таблица `recognition_logs` не содержит критически важной информации для расследования инцидентов: IP-адреса источника, идентификатора сессии, геолокационных данных или других контекстных параметров безопасности.

Системное журналирование через модуль `logging` записывает события в обычные текстовые файлы без защиты от модификации. Злоумышленник с доступом к файловой системе может легко изменить или удалить журналы для сокрытия следов атаки.

## Архитектурные уязвимости

Реализация менеджера камеры как синглтон создает единую точку отказа в системе. Компрометация класса `CameraManager` может привести к полной потере контроля над видеопотоком и возможности подмены входящих данных.

```python
class CameraManager(QObject):
    _instance = None
    _lock = threading.Lock()
    
    def __new__(cls):
        # Единственный экземпляр - потенциальная точка атаки
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
        return cls._instance
```

Отсутствие разделения привилегий в архитектуре системы позволяет всем аутентифицированным администраторам выполнять любые операции без ограничений. Класс `Database` не проверяет права доступа при выполнении критических функций.

Обработка ошибок часто использует общие блоки `except Exception`, что может маскировать специфические атаки или попытки эксплуатации уязвимостей. Такой подход затрудняет обнаружение и анализ инцидентов безопасности.

## Уязвимости конфигурации

Файл конфигурации `config.py` содержит критические параметры безопасности в открытом виде, включая учетные данные администратора по умолчанию. Константы `DEFAULT_ADMIN_USERNAME` и `DEFAULT_ADMIN_PASSWORD` доступны любому, кто имеет доступ к исходному коду.

```python
# Открытые учетные данные в исходном коде
DEFAULT_ADMIN_USERNAME = 'admin'
DEFAULT_ADMIN_PASSWORD = 'admin123'
PASSWORD_MIN_LENGTH = 6
```

Пороги безопасности, такие как `FACE_RECOGNITION_TOLERANCE`, могут быть изменены для снижения требований к точности распознавания, что увеличивает количество ложных срабатываний и снижает общую безопасность системы.

## Проблемы сетевой безопасности

Хотя текущая реализация является локальным приложением, отсутствие шифрования данных создает риски при будущем расширении системы сетевыми компонентами. Биометрические данные передавались бы по сети в незащищенном виде.

Отсутствие механизмов аутентификации на уровне API или внешних интерфейсов делает систему уязвимой при интеграции с другими приложениями или системами управления доступом.

Такой анализ уязвимостей демонстрирует необходимость комплексной доработки системы безопасности для обеспечения защиты биометрических данных пользователей и надежности работы системы в продуктивной среде.