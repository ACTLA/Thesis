# 1.3. Методы защиты биометрических данных в контексте разработанной системы

Анализ текущей реализации показывает необходимость интеграции специализированных модулей безопасности для устранения выявленных уязвимостей. Планируемые модификации системы должны дополнить существующую архитектуру без нарушения базовой функциональности.

## Защита от презентационных атак

Интеграция модуля проверки живого лица требует модификации метода `process_frame` в `FaceRecognitionEngine`. Планируется добавление класса `LivenessDetector`, который будет анализировать последовательность кадров перед передачей их в систему распознавания.

Детекция моргания может быть реализована через анализ соотношения сторон глаз (Eye Aspect Ratio) с использованием библиотеки dlib для определения ключевых точек лица. Метод `calculate_eye_aspect_ratio` будет вычислять изменения геометрии глаз между кадрами для выявления характерных паттернов моргания.

Модификация `CameraManager` должна включать буферизацию последних 10-15 кадров для анализа временных характеристик лица. Свойство `frame_buffer` будет хранить кадры с временными метками для последующего анализа движений.

Интеграция с `FaceRecognitionWidget` потребует добавления индикатора результатов проверки подлинности. Виджет будет отображать не только результат распознавания, но и статус проверки живого лица с цветовой кодировкой.

## Криптографическая защита биометрических шаблонов

Модификация метода `add_user` в классе `Database` должна включать шифрование биометрических шаблонов перед сохранением. Планируется использование библиотеки `cryptography` с алгоритмом Fernet для симметричного шифрования JSON данных.

Класс `BiometricEncryption` будет управлять ключами шифрования с генерацией производных ключей через PBKDF2. Мастер-ключ будет храниться отдельно от базы данных, возможно в переменных окружения или защищенном хранилище ключей.

Метод `get_all_users` потребует модификации для автоматической расшифровки шаблонов при загрузке в кэш `FaceRecognitionEngine`. Расшифровка будет выполняться прозрачно для существующей логики сравнения лиц.

Контроль целостности через HMAC подписи предотвратит модификацию зашифрованных данных. Каждый биометрический шаблон будет сопровождаться подписью, проверяемой при каждом обращении к данным.

## Расширенная система аудита

Планируется создание класса `SecurityAuditLogger` для детального журналирования всех операций безопасности. Класс будет интегрирован в `LoginWindow` для регистрации попыток входа, в `AddUserDialog` для фиксации добавления пользователей и в `FaceRecognitionWidget` для детального анализа событий распознавания.

Таблица `security_logs` расширит текущую схему базы данных дополнительными полями: IP-адрес, идентификатор сессии, контекст операции и уровень риска события. Модификация `database.py` включит методы для работы с расширенным журналированием.

Анализ аномалий будет реализован через класс `AnomalyDetector`, который анализирует паттерны поведения пользователей. Система будет отслеживать частоту обращений, временные паттерны доступа и географические аномалии.

Защита журналов аудита потребует их шифрования и подписания для предотвращения модификации. Планируется использование отдельного ключа для защиты журналов с ротацией ключей по расписанию.

## Контроль доступа и разделение привилегий

Модификация таблицы `admins` включит поле `permissions` для хранения JSON структуры с детализированными правами доступа. Различные роли администраторов получат ограниченный доступ к функциям системы.

Класс `AccessControlManager` будет проверять права доступа перед выполнением критических операций. Интеграция в методы `Database` предотвратит несанкционированное выполнение операций пользователями без соответствующих прав.

Сессионное управление через класс `SessionManager` будет контролировать время жизни сессий, блокировку неактивных учетных записей и принудительное завершение сессий при подозрительной активности.

## Мониторинг производительности и безопасности

Интеграция метрик безопасности в `FaceRecognitionEngine` позволит отслеживать подозрительные паттерны распознавания. Система будет анализировать частоту ложных срабатываний, необычные уровни уверенности и аномальные временные паттерны.

Класс `PerformanceMonitor` будет отслеживать влияние модулей безопасности на производительность системы. Метрики включат время обработки кадров с проверкой подлинности, задержки шифрования и влияние журналирования на отзывчивость интерфейса.

Система уведомлений через `AlertManager` будет информировать администраторов о критических событиях безопасности в реальном времени. Интеграция с `MainWindow` обеспечит отображение предупреждений в пользовательском интерфейсе.

Эти планируемые модификации создадут комплексную систему защиты биометрических данных, интегрированную в существующую архитектуру без нарушения текущей функциональности распознавания лиц.

Журналирование событий должно включать все попытки аутентификации, административные действия, изменения конфигурации системы и потенциальные инциденты безопасности. Каждая запись должна содержать временную метку, идентификатор пользователя, тип события и дополнительные контекстные данные.

```python
class SecurityAuditLogger:
    def __init__(self, log_file_path, encryption_key):
        self.log_file = log_file_path
        self.encryptor = BiometricEncryption(encryption_key)
        
    def log_authentication_attempt(self, user_id, success, confidence, metadata):
        """Регистрация попытки аутентификации"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'event_type': 'AUTHENTICATION_ATTEMPT',
            'user_id': user_id,
            'success': success,
            'confidence': confidence,
            'metadata': metadata,
            'source_ip': self.get_client_ip(),
            'session_id': self.get_session_id()
        }
        
        encrypted_entry = self.encryptor.encrypt_template(log_entry)
        self.write_to_log(encrypted_entry)
    
    def detect_suspicious_patterns(self, time_window_hours=24):
        """Обнаружение подозрительных паттернов активности"""
        recent_logs = self.get_recent_logs(time_window_hours)
        
        # Анализ множественных неудачных попыток
        failed_attempts = [log for log in recent_logs 
                          if not log['success']]
        
        if len(failed_attempts) > SUSPICIOUS_THRESHOLD:
            self.trigger_security_alert('MULTIPLE_FAILED_ATTEMPTS', 
                                       failed_attempts)
```

Анализ аномалий в поведении системы может выявлять потенциальные атаки на ранних стадиях. Система мониторинга должна отслеживать изменения в паттернах использования, необычные времена доступа, аномальные уровни уверенности при распознавании и другие индикаторы компрометации.

Защита журналов аудита имеет критическое значение, поскольку злоумышленники часто пытаются скрыть следы своей деятельности путем модификации или удаления записей журналов. Использование криптографических подписей и распределенного хранения журналов повышает их защищенность.

Эти методы защиты должны применяться комплексно, образуя многоуровневую систему безопасности, способную противостоять различным типам угроз и обеспечивать высокий уровень защиты биометрических данных пользователей.