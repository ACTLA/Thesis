# 3.4. Журналирование операций системы

Система журналирования реализована на двух уровнях: журналы распознавания лиц в базе данных и системные журналы через модуль logging Python. Архитектура обеспечивает детальную регистрацию всех операций для анализа работы системы и выявления проблем безопасности.

## Журналирование событий распознавания

Таблица `recognition_logs` в базе данных фиксирует каждое событие идентификации пользователя с временной меткой, уровнем уверенности и типом результата. Метод `add_recognition_log` в классе `Database` выполняет атомарную запись события с возвращением идентификатора созданной записи.

Структура записи журнала включает ссылку на пользователя через `user_id`, точную временную метку `timestamp` с автоматическим заполнением через `CURRENT_TIMESTAMP`, численное значение уверенности `confidence` от 0.0 до 1.0 и тип события `recognition_type` со значением по умолчанию 'SUCCESS'.

Вызов журналирования в методе `on_face_recognized` виджета распознавания лиц происходит после успешной идентификации пользователя и получения его данных из базы. Система передает идентификатор пользователя, уровень уверенности из результата сравнения и тип события 'SUCCESS'.

Обработка ошибок журналирования изолирована от основного процесса распознавания через блок try-except. Неудачная запись в журнал не прерывает работу системы, но ошибка регистрируется в системном журнале для последующего анализа.

## Отображение журналов в интерфейсе

Метод `get_recognition_report` возвращает детальную информацию о событиях распознавания с объединением таблиц пользователей и журналов. Запрос включает полное имя пользователя и его код для читаемого отображения в интерфейсе.

Главное окно системы отображает последние события распознавания в таблице `recent_table` через метод `update_recent_recognitions`. Таблица включает колонки идентификатора пользователя, имени, времени, уверенности в процентах и статуса операции.

Страница отчетов содержит расширенную таблицу `reports_table` с отображением до 50 последних событий. Метод `update_reports_table` форматирует уверенность как процентное значение и сортирует записи по убыванию времени для показа самых свежих событий сверху.

Автоматическое обновление таблиц происходит при переключении на соответствующие вкладки главного окна. Методы `show_dashboard` и `show_reports` вызывают обновление данных для отображения актуальной информации пользователю.

## Системное журналирование

Настройка системного журналирования в функции `setup_logging` создает иерархию журналов с записью в файл и консоль. Ротирующий файловый обработчик ограничивает размер журнала 10 МБ с сохранением 5 резервных копий.

Конфигурация журналирования использует формат `LOG_FORMAT` с временной меткой, именем модуля, уровнем сообщения и текстом. Уровень журналирования устанавливается через константу `LOG_LEVEL` для контроля детализации записей.

Журналы камеры в классе `CameraManager` фиксируют инициализацию, ошибки подключения, изменения состояния и освобождение ресурсов. Каждое критическое событие сопровождается записью с соответствующим уровнем важности.

Движок распознавания лиц записывает статистику обработки, ошибки анализа кадров и результаты загрузки биометрических шаблонов. Система отслеживает производительность через подсчет обработанных кадров и времени выполнения операций.

## Статистические данные

Методы `get_today_recognition_count` и `get_unique_users_today` предоставляют агрегированную статистику для отображения в панели управления. Запросы используют SQL функции COUNT и DISTINCT для подсчета событий за текущий день.

Карточки статистики в главном окне отображают общее количество пользователей через `len(self.db.get_all_users())`, количество распознаваний за день и количество уникальных пользователей. Метод `create_stat_card` создает визуальные элементы с иконками и цветовой индикацией.

Обновление статистики происходит при каждом переключении на панель управления через метод `show_dashboard`. Система запрашивает актуальные данные из базы для отображения текущего состояния работы.

Кэширование статистических данных не реализовано в текущей версии, что приводит к выполнению запросов при каждом обновлении интерфейса. В будущих версиях планируется добавление кэширования с обновлением по событиям.

## Архивирование и ротация журналов

Автоматическая ротация системных журналов настроена через `RotatingFileHandler` с максимальным размером файла 10 МБ и сохранением 5 архивных копий. При превышении размера создается новый файл журнала, а старые архивируются с численными суффиксами.

Журналы базы данных не имеют встроенного механизма архивирования, что может привести к росту размера базы данных при длительной эксплуатации. Система требует ручного управления размером таблицы журналов или добавления автоматического архивирования.

Путь к файлам журналов определяется константой `LOGS_DIR` в конфигурации системы. Директория создается автоматически при первом запуске приложения, если не существует в файловой системе.

Права доступа к файлам журналов наследуются от настроек операционной системы без дополнительных ограничений. В продуктивной среде рекомендуется настройка специальных прав доступа для защиты журналов от несанкционированного изменения.

## Анализ и мониторинг

Система не включает автоматизированный анализ журналов для выявления аномалий или подозрительной активности. Анализ выполняется вручную через просмотр интерфейса отчетов или прямой доступ к файлам журналов и базе данных.

Индикаторы состояния в пользовательском интерфейсе отображают базовую информацию о работе системы: статус камеры, последние события распознавания и общую статистику. Цветовая кодировка помогает быстро оценить состояние компонентов.

Экспорт журналов не реализован в текущей версии системы. Доступ к данным возможен через SQL запросы к базе данных или чтение текстовых файлов журналов внешними инструментами анализа.

Централизация журналов отсутствует - каждый экземпляр системы ведет собственные журналы локально. При развертывании нескольких экземпляров требуется отдельная настройка сбора и анализа журналов с различных узлов.

Такая реализация журналирования обеспечивает базовую регистрацию событий системы и создает основу для интеграции расширенных механизмов аудита и мониторинга безопасности в будущих версиях системы.