# 2.1. Архитектура и структура программного комплекса

Разработанная автоматизированная система распознавания лиц представляет собой комплексное программное решение, построенное на принципах модульности и расширяемости. Система реализована на языке Python с использованием современных библиотек компьютерного зрения и машинного обучения, что обеспечивает высокую точность распознавания и производительность обработки видеопотока.

## Общая архитектура системы

Архитектура системы основана на принципе разделения ответственности между компонентами. Главный файл `main.py` служит точкой входа и координирует работу всех модулей системы. При запуске система инициализирует логирование, проверяет зависимости и создает экземпляр основного приложения `FaceRecognitionApp`.

Инициализация приложения начинается с создания заставки, которая информирует пользователя о процессе загрузки. Система автоматически проверяет наличие необходимых библиотек, включая OpenCV для работы с видео, face_recognition для алгоритмов распознавания лиц и PyQt5 для графического интерфейса.

```python
def check_dependencies():
    missing_deps = []
    try:
        import cv2
        import face_recognition
        import numpy
        from PyQt5 import QtWidgets
    except ImportError as e:
        missing_deps.append(str(e))
    return missing_deps
```

Модульная структура системы включает несколько ключевых компонентов. Пакет `ui` содержит все элементы пользовательского интерфейса: окно входа в систему, главное окно приложения, диалог добавления пользователей и виджет распознавания лиц. Пакет `core` включает основную логику обработки: менеджер камеры и движок распознавания лиц.

## Система конфигурации

Конфигурация системы централизована в файле `config.py`, который содержит все настраиваемые параметры работы. Это включает пути к файлам и директориям, параметры камеры, настройки алгоритмов распознавания и параметры пользовательского интерфейса.

Основные конфигурационные константы определяют поведение системы:

```python
# Настройки камеры
CAMERA_INDEX = 0
CAMERA_WIDTH = 640
CAMERA_HEIGHT = 480
CAMERA_FPS = 30

# Настройки распознавания лиц
FACE_RECOGNITION_TOLERANCE = 0.6
RESIZE_SCALE = 0.25
RECOGNITION_COOLDOWN = 3
```

Система автоматически создает необходимые директории при первом запуске. Директория `data` содержит файл базы данных SQLite, а директория `user_photos` хранит фотографии зарегистрированных пользователей. Логи работы системы сохраняются в директории `logs` с автоматической ротацией файлов.

## Управление потоками выполнения

Архитектура системы построена с учетом многопоточности для обеспечения отзывчивости пользовательского интерфейса. Основной поток GUI отвечает за отображение интерфейса и обработку пользовательского ввода, в то время как отдельные потоки обрабатывают видеопоток с камеры и выполняют алгоритмы распознавания лиц.

Синхронизация между потоками осуществляется с использованием сигнально-слотового механизма PyQt5. Это позволяет безопасно передавать данные между потоками и обновлять интерфейс пользователя результатами обработки видео.

Менеджер камеры `CameraManager` реализован как синглтон, что гарантирует единственный экземпляр для всей системы и предотвращает конфликты доступа к аппаратным ресурсам камеры:

```python
class CameraManager(QObject):
    _instance = None
    _lock = threading.Lock()
    
    def __new__(cls):
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
        return cls._instance
```

## Обработка ошибок и отказоустойчивость

Система включает комплексную обработку ошибок на всех уровнях архитектуры. Функция `main()` обрабатывает критические исключения и обеспечивает корректное завершение работы приложения даже в случае непредвиденных ошибок.

При недоступности камеры система информирует пользователя и продолжает работу в ограниченном режиме. Проверка доступности видеооборудования выполняется при запуске и периодически во время работы для обнаружения подключения или отключения камеры.

База данных автоматически создается при первом запуске системы, если файл не существует. Система проверяет целостность структуры базы данных и выполняет необходимые миграции при обновлении версии приложения.

Логирование ошибок осуществляется через стандартный модуль `logging` Python с записью в файлы и консоль. Это обеспечивает детальную информацию для диагностики проблем и анализа работы системы в продуктивной среде.

Такая архитектура создает надежную основу для работы системы распознавания лиц и обеспечивает простоту добавления новых модулей и функций в будущих версиях.