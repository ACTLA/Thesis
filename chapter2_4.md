# 2.4. Пользовательский интерфейс и управление данными

Пользовательский интерфейс системы спроектирован с учетом современных принципов юзабилити и обеспечивает интуитивное взаимодействие с функциями распознавания лиц. Интерфейс построен на библиотеке PyQt5 и включает несколько специализированных компонентов для различных аспектов работы системы.

## Архитектура интерфейса

Система интерфейса построена по модульному принципу, где каждое окно представляет собой отдельный класс с четко определенной функциональностью. Главные компоненты включают окно входа в систему `LoginWindow`, основное окно приложения `MainWindow`, диалог добавления пользователей `AddUserDialog` и виджет распознавания лиц `FaceRecognitionWidget`.

Окно входа обеспечивает безопасную аутентификацию администраторов перед предоставлением доступа к функциям управления. Интерфейс адаптируется под различные размеры экранов и автоматически центрируется при запуске.

```python
class LoginWindow(QWidget):
    login_successful = pyqtSignal(dict)
    
    def __init__(self):
        super().__init__()
        self.db = Database()
        self.init_ui()
        
    def center_on_screen(self):
        desktop = QDesktopWidget()
        screen_rect = desktop.screenGeometry()
        window_rect = self.geometry()
        
        x = (screen_rect.width() - window_rect.width()) // 2
        y = (screen_rect.height() - window_rect.height()) // 2
        self.move(max(0, x), max(0, y))
```

Стилизация интерфейса использует современные принципы материального дизайна с градиентными фонами, закругленными углами и плавными переходами. Цветовая схема основана на корпоративных цветах и обеспечивает хорошую читаемость во всех условиях освещения.

## Главное окно и навигация

Основное окно приложения построено с использованием боковой панели навигации и области контента со стековым виджетом. Это решение обеспечивает логическое разделение функций и интуитивную навигацию между различными разделами системы.

Боковая панель включает кнопки переключения между основными разделами: панель управления, управление пользователями, распознавание лиц и отчеты. Каждая кнопка имеет соответствующую иконку и текстовое описание для ясности навигации.

```python
def create_sidebar(self):
    sidebar = QFrame()
    sidebar.setFixedWidth(250)
    
    nav_buttons = [
        ("Панель управления", self.show_dashboard),
        ("Пользователи", self.show_users),
        ("Распознавание лиц", self.show_face_recognition),
        ("Отчеты", self.show_reports)
    ]
    
    for text, callback in nav_buttons:
        btn = QPushButton(f"{text}")
        btn.clicked.connect(callback)
        layout.addWidget(btn)
```

Панель управления отображает статистические данные в виде карточек с ключевыми показателями работы системы. Карточки показывают общее количество пользователей, статистику распознаваний за день и статус системы. Информация обновляется автоматически при переключении на этот раздел.

Таблица последних событий распознавания обеспечивает оперативный мониторинг активности системы. Данные отображаются в хронологическом порядке с информацией о времени, пользователе и уровне уверенности распознавания.

## Виджет распознавания лиц

Специализированный виджет распознавания лиц представляет собой наиболее сложный компонент интерфейса, объединяющий отображение видеопотока, управление камерой и визуализацию результатов идентификации. Виджет разделен на две основные области: видеопоток с элементами управления и информационную панель.

Область отображения видео адаптируется под размер окна и показывает текущий кадр с камеры в реальном времени. При обнаружении лица система выделяет его контуром, цвет которого зависит от результата распознавания - зеленый для идентифицированных пользователей и желтый для неизвестных лиц.

```python
def display_frame_simple(self, frame):
    try:
        rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
        height, width, channel = rgb_frame.shape
        bytes_per_line = 3 * width
        
        q_image = QImage(rgb_frame.data, width, height, bytes_per_line, QImage.Format_RGB888)
        pixmap = QPixmap.fromImage(q_image)
        
        label_size = self.video_label.size()
        if label_size.width() > 0 and label_size.height() > 0:
            scaled_pixmap = pixmap.scaled(label_size, Qt.KeepAspectRatio, Qt.SmoothTransformation)
            self.video_label.setPixmap(scaled_pixmap)
    except Exception:
        pass
```

Информационная панель отображает детали последнего распознанного пользователя, включая фотографию, полное имя, идентификатор и показатель уверенности системы. Фотография загружается из файловой системы, а при отсутствии файла отображается стандартная иконка пользователя.

Журнал событий в реальном времени показывает последние распознавания с временными метками. Список автоматически обновляется при каждом новом событии и ограничивается десятью последними записями для поддержания производительности интерфейса.

## Диалог добавления пользователей

Диалог добавления пользователей построен с использованием адаптивного интерфейса, который корректно отображается на различных размерах экранов. Основной контент разделен между формой ввода данных и системой захвата биометрических характеристик.

Вкладочный интерфейс позволяет пользователю выбрать способ добавления фотографии: загрузка из файла или съемка с камеры. Каждая вкладка содержит специализированные элементы управления и проверки качества биометрических данных.

```python
def create_camera_tab(self):
    tab = QWidget()
    layout = QVBoxLayout()
    
    self.camera_label = QLabel()
    self.camera_label.setMinimumSize(300, 200)
    self.camera_label.setAlignment(Qt.AlignCenter)
    layout.addWidget(self.camera_label)
    
    # Кнопки управления камерой
    camera_controls = QHBoxLayout()
    
    self.start_camera_button = QPushButton("Включить")
    self.capture_button = QPushButton("Захватить")
    
    camera_controls.addWidget(self.start_camera_button)
    camera_controls.addWidget(self.capture_button)
    layout.addLayout(camera_controls)
```

Система проверки качества биометрических данных анализирует загруженные изображения на предмет наличия лица, отсутствия множественных лиц и достаточного разрешения для надежного распознавания. При обнаружении проблем пользователь получает конкретные рекомендации по их устранению.

Интеграция с камерой в диалоге добавления использует отдельный поток для предотвращения блокировки интерфейса. Поток обеспечивает непрерывное отображение видео и автоматическое обнаружение лиц с визуальной индикацией результатов.

## Управление данными пользователей

Раздел управления пользователями представляет табличный интерфейс со всеми зарегистрированными пользователями системы. Таблица включает колонки с основной информацией и элементы управления для каждой записи.

Операции добавления и удаления пользователей интегрированы в интерфейс через контекстные кнопки и подтверждающие диалоги. Система требует подтверждения перед выполнением критических операций для предотвращения случайных изменений.

```python
def delete_user(self, user_id):
    reply = QMessageBox.question(
        self, "Подтверждение удаления", 
        "Вы уверены, что хотите удалить этого пользователя?",
        QMessageBox.Yes | QMessageBox.No
    )
    
    if reply == QMessageBox.Yes:
        self.db.delete_user(user_id)
        self.update_users_table()
        
        if hasattr(self, 'face_recognition_widget'):
            self.face_recognition_widget.recognition_engine.remove_face(user_id)
```

Автоматическое обновление кэша распознавания происходит при изменении данных пользователей. Система синхронизирует состояние базы данных с кэшем движка распознавания для обеспечения актуальности биометрических данных.

## Система уведомлений и обратной связи

Интерфейс включает комплексную систему уведомлений для информирования пользователя о результатах операций и состоянии системы. Уведомления различаются по типу и важности, используя соответствующие цвета и иконки.

Индикаторы состояния отображают текущий статус критических компонентов: подключение камеры, состояние базы данных и активность распознавания. Цветовая кодировка обеспечивает быстрое визуальное определение проблемных областей.

Анимационные эффекты используются для привлечения внимания к важным событиям, таким как успешное распознавание пользователя или возникновение ошибок. Анимации выполняются плавно и не мешают основной работе с системой.

Контекстные подсказки и справочная информация встроены в интерфейс для помощи новым пользователям в освоении функций системы. Подсказки отображаются при наведении курсора на элементы управления и содержат краткие описания их назначения.

Такая реализация пользовательского интерфейса обеспечивает эффективное взаимодействие с системой распознавания лиц и создает удобную среду для ежедневной работы операторов системы безопасности.